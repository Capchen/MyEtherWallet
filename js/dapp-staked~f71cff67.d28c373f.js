(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dapp-staked~f71cff67"],{"0143":function(t,e,a){t.exports=a.p+"img/icon-dapp-stake.21f5fa37.svg"},"1f5f":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("the-wrapper-dapp",{attrs:{"is-new-header":!0,"dapp-img":t.headerImg,"banner-text":t.header,"tab-items":t.tabs,"active-tab":t.activeTab,"external-contents":"","on-tab":t.tabChanged,"valid-networks":t.validNetworks},scopedSlots:t._u([{key:"HeaderBody",fn:function(){return[a("v-divider",{staticClass:"textMedium my-3"}),a("div",{staticClass:"d-flex flex-wrap align-center justify-center"},[a("div",{staticClass:"text-uppercase textMedium--text font-weight-bold"},[t._v(" Total Staked: "),a("span",{staticClass:"greenPrimary--text"},[t._v(t._s(t.totalStaked))])]),a("v-icon",{attrs:{color:"textMedium"}},[t._v("mdi-circle-medium")]),a("div",{staticClass:"text-uppercase textMedium--text font-weight-bold"},[t._v(" Current APR: "),a("span",{staticClass:"greenPrimary--text"},[t._v(t._s(t.currentAprFormatted))])])],1),a("v-btn-toggle",{staticClass:"d-flex align-center justify-center mt-3 white--text",attrs:{mandatory:"",borderless:"","active-class":"expandHeader font-weight-bold","background-color":"transparent"},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[a("v-btn",{staticClass:"px-md-9 white--text text-transform--initial",class:0===t.activeTab?"staked-tab-active":"staked-tab-inactive",attrs:{color:""}},[t._v(" New stake ")]),a("v-btn",{class:["px-md-9 white--text text-transform--initial d-flex  flex-column align-center",1===t.activeTab?"staked-tab-active":"staked-tab-inactive"],attrs:{color:""}},[a("div",[a("div",{class:["white--text",1===t.activeTab?"font-weight-medium":""]},[t._v(" My stake ")]),t.loadingValidators?t._e():a("div",{staticClass:"mew-caption textLight--text"},[t._v(" "+t._s(t.loadingValidators?"--":t.myETHTotalStaked)+" ")])])])],1)]},proxy:!0},{key:"HeaderRight",fn:function(){return[a("div",{staticClass:"text-right"},[a("a",{staticClass:"greenPrimary--text font-weight-medium text-right",attrs:{href:t.getArticle("stake-eth2-mew-web"),target:"_blank"}},[t._v(" New to staking? Learn more "),a("v-icon",{staticClass:"ml-1",attrs:{small:"",color:"greenPrimary"}},[t._v("mdi-open-in-new")])],1)])]},proxy:!0},{key:"tabContent1",fn:function(){return[a("v-sheet",{staticClass:"mx-auto",attrs:{"min-height":"500px","max-width":"700px",color:"transparent"}},[a("staked-stepper",{ref:"stakedStepper",attrs:{"current-apr":t.handlerStaked.apr,"start-provision":t.startProvision,"polling-status":t.pollingStatus},on:{readyToStake:t.sendTransaction}})],1)]},proxy:!0},{key:"tabContent2",fn:function(){return[a("v-sheet",{staticClass:"py-13 mx-auto",attrs:{"min-height":"500px","max-width":"700px",color:"transparent"}},[a("staked-status",{attrs:{"tx-receipt":t.handlerStaked.txReceipt,"pending-hash":t.pendingTxHash,validators:t.validators,loading:t.loadingValidators,amount:t.amount,"refetch-validators":t.refetchValidators}})],1)]},proxy:!0}])})},i=[],n=a("2f62"),r=a("4223");const o={STAKED:{NAME:"Staked",PATH:"staked"},STATUS:{NAME:"StakedStatus",PATH:"status"}};var d=a("ac8e"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"staked-status-container mx-auto"},[a("mew-popup",{attrs:{"max-width":"690px",show:t.openWithdrawalModal,"has-buttons":!1,"has-body-content":!0,title:t.modalTitle,"left-btn":t.leftBtn}},[a("div",[1===t.step?a("div",{staticClass:"text-center"},[a("mew-warning-sheet",{staticClass:"mb-5",attrs:{title:"",description:"The withdrawal address can only be set once and can never be changed. Please make sure the withdrawal address you are setting is a non-custodial wallet to which you have full access with a recovery phrase or private key. Do NOT use an exchange address or a smart contract wallet."}}),a("div",{staticClass:"mew-heading-3 mb-3 text-left"},[t._v(" Your Withdrawal Address ")]),a("module-address-book",{ref:"addressInput",staticClass:"AddressInput",attrs:{label:"Address","preselect-curr-wallet-adr":!0,currency:t.currencyName},on:{setAddress:t.setAddress}})],1):t._e(),2===t.step?a("div",{staticClass:"text-center"},[t._l(t.buttons,(function(e,s){return a("div",{key:s,staticClass:"mb-5"},[a("mew-button",{class:e.class,staticStyle:{height:"160px"},attrs:{"has-full-width":"","color-theme":"greyMedium","btn-style":"outline"},nativeOn:{click:function(t){return e.fn.apply(null,arguments)}}},[a("div",{staticClass:"text-left d-flex align-center justify-space-between px-2",staticStyle:{width:"100%"}},[a("div",{staticClass:"mew-heading-2 textDark--text"},[t._v(" "+t._s(e.label)+" ")]),a("img",{staticClass:"mr-4 d-none d-sm-block",attrs:{width:"80",src:e.icon}})])])],1)})),a("input",{ref:"jsonInput",staticStyle:{display:"none"},attrs:{type:"file",name:"file"},on:{change:t.uploadFile}})],2):t._e(),3===t.step?a("div",{staticClass:"text-center"},[t.isKeystore?a("div",[a("mew-input",{ref:"passwordInput",attrs:{label:"Enter Password",placeholder:"Enter my keystore password",type:"password"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1):t._e(),t.isMnemonic?a("div",[a("phrase-block",{staticClass:"mb-8"},[a("v-row",t._l(t.length,(function(e){return a("v-col",{key:"mnemonicInput"+e,attrs:{cols:"6",lg:"3",md:"3",sm:"4"}},[a("v-text-field",{ref:"mnemonicInput"+e,refInFor:!0,attrs:{name:"mnemonicInput"+e,label:e+".",autocomplete:"off",autofocus:1===e},model:{value:t.phrase[e],callback:function(a){t.$set(t.phrase,e,a)},expression:"phrase[n]"}})],1)})),1)],1)],1):t._e()]):t._e(),4===t.step?a("div",{staticClass:"mb-2"},[a("mew-sheet",{staticClass:"pa-4"},[a("div",{staticClass:"mew-heading-3 black--text"},[t._v(" Setting address: "+t._s(t.executionAddress)+" as the withdrawal address. ")])]),a("mew-warning-sheet",{staticClass:"my-4",attrs:{title:"Please verify",description:"The withdrawal address can only be set once. Please make sure you are setting the correct address."}})],1):t._e(),a("div",{staticClass:"mb-2 text-center d-flex align-center justify-center"},[t.step>1?a("mew-button",{staticClass:"mr-2",attrs:{title:"Back","btn-style":"outline","btn-size":"xlarge"},nativeOn:{click:function(e){return function(){t.back()}.apply(null,arguments)}}}):t._e(),2!=t.step?a("mew-button",{attrs:{title:t.nextButton.title,disabled:t.nextButton.disabled,loading:t.loadingButton,"btn-size":"xlarge"},nativeOn:{click:function(e){return function(){t.nextButton.fn()}.apply(null,arguments)}}}):t._e()],1)])]),t.loading?a("div",[a("v-skeleton-loader",{attrs:{width:"150px",type:"list-item"}}),t._l(3,(function(t){return a("v-skeleton-loader",{key:t,staticClass:"mb-4",attrs:{height:"100px",type:"image"}})}))],2):t._e(),t.loading?t._e():a("div",[0===t.validators.length&&0===t.justStakedValidator.length||0===t.allPendingValidators.length&&0===t.activeValidators.length?a("div",[t._v(" You are currently not staking any eth. ")]):t._e(),t.allPendingValidators.length>0?a("div",{staticClass:"pb-8"},[a("span",{staticClass:"mew-heading-3"},[t._v("Pending")]),t._l(t.allPendingValidators,(function(e,s){return a("div",{key:e+s,staticClass:"mt-4 d-flex flex-column align-center cursor-pointer justify-space-between"},[a("div",{class:["rounded-t-lg header-container greyLight pa-5 full-width d-flex flex-row align-center justify-space-between",t.isExpanded(s)?"rounded-t-lg":"rounded-lg"],on:{click:function(e){return t.expand(s)}}},[a("div",{staticClass:"left-container d-flex"},[a("img",{attrs:{src:t.iconETHNavy,height:"22",alt:"ethereum"}}),a("div",{staticClass:"ml-3"},[a("div",{staticClass:"mew-heading-3"},[t._v(" "+t._s(e.amount)+" "),a("span",{staticClass:"mew-caption"},[t._v("ETH")])]),a("div",{staticClass:"textMedium--text mt-1"},[t._v(" "+t._s(e.amountFiat)+" ")])])]),a("div",[a("v-progress-circular",{attrs:{size:"18",width:"2",color:"greenPrimary",indeterminate:""}}),a("v-icon",{staticClass:"ml-5",attrs:{color:"greyPrimary",size:"22"}},[t._v(t._s(t.isExpanded(s)?"mdi-chevron-up":"mdi-chevron-down"))])],1)]),t.isExpanded(s)?a("div",{staticClass:"border-container rounded-b-lg full-width pa-5"},[a("div",{staticClass:"mt-5 mb-8 font-weight-bold"},[t._v("More Info")]),e.status.toLowerCase()===t.STATUS_TYPES.CREATED?a("div",{staticClass:"d-flex"},[a("v-progress-circular",{staticClass:"ml-4",attrs:{size:"18",width:"2",color:"greenPrimary",indeterminate:""}}),a("span",{staticClass:"ml-2"},[t._v(t._s(!e.justStaked||t.txReceipt?"Processing":"Sending"))])],1):t._e(),e.status.toLowerCase()===t.STATUS_TYPES.DEPOSITED||e.status.toLowerCase()===t.STATUS_TYPES.PENDING?a("div",{staticClass:"d-flex"},[a("v-icon",{attrs:{size:"20",color:"greenPrimary"}},[t._v("mdi-check-circle")]),a("span",{staticClass:"ml-2"},[t._v("Deposited")])],1):t._e(),e.status.toLowerCase()===t.STATUS_TYPES.FAILED?a("div",{staticClass:"d-flex align-center"},[a("v-icon",{attrs:{size:"20",color:"redPrimary"}},[t._v("mdi-close-circle")]),a("span",{staticClass:"ml-2"},[t._v("Failed")])],1):t._e(),a("div",{staticClass:"d-flex mt-6"},[e.etherscanUrl?a("a",{staticClass:"font-weight-medium",attrs:{rel:"noopener noreferrer",href:e.etherscanUrl,target:"_blank"}},[t._v("View on Etherscan "),a("v-icon",{attrs:{color:"greenPrimary",size:"14"}},[t._v("mdi-open-in-new")])],1):t._e(),e.ethVmUrl&&!t.onGoerli?a("a",{staticClass:"font-weight-medium ml-5",attrs:{rel:"noopener noreferrer",href:e.ethVmUrl,target:"_blank"}},[t._v("View on EthVM "),a("v-icon",{attrs:{color:"greenPrimary",size:"14"}},[t._v("mdi-open-in-new")])],1):t._e()]),e.status.toLowerCase()===t.STATUS_TYPES.DEPOSITED||e.status.toLowerCase()===t.STATUS_TYPES.PENDING?a("div",{staticClass:"d-flex flex-column mt-9"},[a("div",{staticClass:"d-flex align-center"},[a("v-progress-circular",{attrs:{size:"18",width:"2",color:"greenPrimary",indeterminate:""}}),a("span",{staticClass:"ml-2"},[t._v("Waiting for validator activation")])],1),a("span",{staticClass:"mew-label font-weight-medium textLight--text mt-1"},[t._v("Estimated wait time: "+t._s(e.estimatedWaitTime)+" ")]),e.url?a("a",{staticClass:"font-weight-medium mt-5",attrs:{rel:"noopener noreferrer",href:e.url,target:"_blank"}},[t._v("Eth2 Beacon Chain transactions "),a("v-icon",{attrs:{color:"greenPrimary",size:"14"}},[t._v("mdi-open-in-new")])],1):t._e()]):t._e()]):t._e()])}))],2):t._e(),t.activeValidators.length>0?a("div",[a("span",{staticClass:"mew-heading-3"},[t._v("Active")]),t._l(t.activeValidators,(function(e,s){return a("div",{key:e+s,staticClass:"border-container rounded-lg pa-5 mt-4 d-flex justify-space-between"},[a("div",{staticClass:"left-container d-flex"},[a("img",{attrs:{src:t.iconETHNavy,height:"26",alt:"ethereum"}}),a("div",{staticClass:"left-container-details ml-3"},[a("div",{staticClass:"mew-heading-2"},[t._v(" "+t._s(e.totalBalanceETH+" ETH")+" ")]),a("div",{staticClass:"font-weight-medium mt-1"},[t._v(" "+t._s(e.totalBalanceFiat)+" ")]),a("div",{staticClass:"textLight--text mt-2"},[t._v(" Earned "),a("span",{staticClass:"greenPrimary--text"},[t._v(t._s(t.convertTotalReward(e.detailed_balance_info.total_reward_and_fees,e.detailed_balance_info.conversion_factor_power)+" ETH"))]),a("br"),t._v(" Average APR "+t._s(e.averageApr)+" ")]),a("mew-button",{staticClass:"mt-1",attrs:{title:e.withdrawal_set?"Already set":"Set withdrawal address",disabled:e.withdrawal_set,"btn-size":"medium"},nativeOn:{click:function(a){return function(){t.openModal(e)}.apply(null,arguments)}}})],1)]),a("div",[a("a",{staticClass:"font-weight-medium",attrs:{rel:"noopener noreferrer",href:e.url,target:"_blank"}},[t._v("View validator "),a("v-icon",{attrs:{color:"greenPrimary",size:"14"}},[t._v("mdi-open-in-new")])],1)])])}))],2):t._e()])],1)},c=[],h=(a("14d9"),a("13d5"),a("e9c4"),a("caad"),a("901e")),u=a.n(h),p=a("c1df"),m=a.n(p),v=a("35be"),g=a("7f65"),w=a("4a2b"),f=a("913e"),b=a("9b88"),x=a("9609"),y=a("56e8"),k=a.n(y),T=a("2ef0"),_={components:{phraseBlock:()=>a.e("chunk-04918fe0").then(a.bind(null,"a2c8")),ModuleAddressBook:()=>a.e("chunk-3d22eaca").then(a.bind(null,"4b90"))},props:{validators:{type:Array,default:()=>[]},pendingHash:{type:String,default:""},txReceipt:{type:Boolean,default:!0},loading:{type:Boolean,default:!0},amount:{type:Number,default:0},refetchValidators:{type:Function,default:()=>{}}},data(){return{iconETHNavy:k.a,expanded:0,STATUS_TYPES:w["b"],openWithdrawalModal:!1,selectedValidator:null,step:1,executionAddress:"",isValidAddress:!1,selectedRecoveryType:"",file:{},password:"",blsExecution:"",phrase:{},length:24,loadingButton:!1}},computed:{...Object(n["e"])("wallet",["address"]),...Object(n["e"])("global",["preferredCurrency"]),...Object(n["e"])("external",["currencyRate"]),...Object(n["e"])("stakedStore",["validatorIndex"]),...Object(n["c"])("external",["fiatValue"]),...Object(n["c"])("global",["network","getFiatValue"]),nextButton(){const t={title:"Next",disabled:!1,fn:this.nextStep};return 1===this.step?Object.assign({},t,{disabled:!this.isValidAddress&&""!==this.executionAddress,fn:this.nextStep}):3===this.step?this.isKeystore?Object.assign({},t,{disabled:this.loadingButton||!this.validPassword,fn:this.validateUserInputs}):Object.assign({},t,{disabled:!this.isValidMnemonic,fn:this.validateUserInputs}):4===this.step?Object.assign({},t,{title:"Set withdrawal address",disabled:this.loadingButton,fn:this.setWithdrawalAddress}):t},phraseToLength(){const t=Object.values(this.phrase);return t.length>this.length&&(t.length=this.length),t},isValidMnemonic(){return this.phraseToLength.length===this.length},parsedPhrase(){return this.phraseToLength.join(" ").toLowerCase()},buttons(){return[{label:"Keystore",icon:a("041b"),fn:()=>{this.userSelectFile()}},{label:"Mnemonic Phrase",icon:a("58fb"),fn:()=>{this.setType(x["a"].MNEMONIC)}}]},currencyName(){return this.network.type.currencyName},validatorsRaw(){const t=[];return this.validators.map(e=>{e.raw.map(e=>{t.push(e)})}),t},activeValidators(){return this.validatorsRaw.reduce((t,e)=>{if(e.status.toLowerCase()===w["b"].ACTIVE||e.status.toLowerCase()===w["b"].EXITED){const a=this.convertToEth1(e.detailed_balance_info.balance,e.detailed_balance_info.conversion_factor_power),s=new u.a(a).minus(e.amount);t.push(Object.assign({},e,{url:`${g["a"].network[this.network.type.name].url}${e.validator_index}`,earned:Object(d["c"])(s).value,totalBalanceETH:Object(d["c"])(a).value,totalBalanceFiat:this.getFiatValue(new u.a(a).times(this.fiatValue)),averageApr:Object(d["g"])(this.getAverageApr(e.created,s,e.amount)).value,withdrawal_set:this.findValidatorIndex(e.validator_index)||e.withdrawal_credentials_are_eth1Address}))}return t},[])},pendingValidators(){return this.validatorsRaw.reduce((t,e)=>{const a=864e5,s=new Date(e.created).getTime()+a,i=(new Date).getTime()<=s;return(e.status.toLowerCase()===w["b"].DEPOSITED||e.status.toLowerCase()===w["b"].PENDING||e.status.toLowerCase()===w["b"].FAILED||e.status.toLowerCase()===w["b"].CREATED&&i)&&t.push({amount:Object(d["c"])(e.amount).value,amountFiat:this.getFiatValue(new u.a(e.amount).times(this.fiatValue)),status:e.status,ethVmUrl:g["a"].network[this.network.type.name].ethvmAddrUrl+this.address,etherscanUrl:g["a"].network[this.network.type.name].etherscanAddrUrl+this.address,url:e.address?g["a"].network[this.network.type.name].url+"0x"+e.address:"",estimatedWaitTime:e.queue&&e.queue.estimated_activation_timestamp?this.getEstimatedDuration(e.queue.estimated_activation_timestamp):"~"}),t},[])},justStakedValidator(){return this.pendingHash?[{amount:Object(d["c"])(this.amount).value,amountFiat:this.getFiatValue(new u.a(this.amount).times(this.fiatValue)),justStaked:!0,status:w["b"].CREATED,ethVmUrl:this.pendingHash?g["a"].network[this.network.type.name].ethvmTxUrl+this.pendingHash:null,etherscanUrl:this.pendingHash?g["a"].network[this.network.type.name].etherscanTxUrl+this.pendingHash:null}]:[]},allPendingValidators(){return this.justStakedValidator.concat(this.pendingValidators)},leftBtn(){return{text:"Cancel",color:"basic",method:this.closeModal}},modalTitle(){return 1===this.step?"Provide withdrawal address":2===this.step?"Choose recovery method":3===this.step&&this.isKeystore?"Enter Keystore Password":3===this.step&&this.isMnemonic?"Enter Mnemonic Phrase":4===this.step?"Verify details":""},isKeystore(){return this.selectedRecoveryType===x["a"].KEYSTORE},isMnemonic(){return this.selectedRecoveryType===x["a"].MNEMONIC},validPassword(){return this.password.length>3}},watch:{phrase:{deep:!0,handler:function(t){if(t&&!Object(T["isEmpty"])(t)&&!Object(T["isEmpty"])(t[1])){this.checkPhrase(t);const e=t[1].split(" ");if(12===e.length||24===e.length){this.length=e.length;const t={};e.forEach((e,a)=>{t[a+1]=e.toLowerCase()}),this.phrase=t}}}}},methods:{...Object(n["b"])("stakedStore",["addValidatorIndex"]),findValidatorIndex(t){const e=!!this.validatorIndex.find(e=>t===e);return!!e},convertTotalReward(t,e){const a=u()(t).div(u()(10).pow(e)).toString(),s=u()(a).gt(0)?a:u()(0).toString();return s.length>10?s.slice(0,9)+"...":s},setWithdrawalAddress(){const t="ETH"===this.network.type.name?"mainnet":"staging",e=`https://${t}.mewwallet.dev/v2/stake/upgrade`;this.blsExecution.message.validator_index=parseInt(this.blsExecution.message.validator_index),this.loadingButton=!0,fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({signed:[this.blsExecution]})}).then(t=>t.ok?(this.addValidatorIndex(this.selectedValidator.validator_index),void Object(b["e"])("Successfully set withdrawal address!",{},b["d"])):t.json().then(t=>{JSON.stringify(t).includes("withdrawal credential prefix is not a BLS prefix")?(this.addValidatorIndex(this.selectedValidator.validator_index),Object(b["e"])("Withdrawal credentials are already set for this validator",{},b["f"])):Object(b["e"])(t.error?t.error:t.msg,{},b["a"])})).finally(()=>{this.reset()})},checkPhrase(t){const e={};let a=!1;Object.values(t).forEach((t,s)=>{Object(T["isEmpty"])(t)?a=!0:e[s+1]=t.toLowerCase()}),a&&(this.phrase=e)},async validateUserInputs(){this.loadingButton=!0;try{this.validating=!0;const t="ETH"===this.network.type.name?"mainnet":"goerli";this.isKeystore?this.blsExecution=await Object(v["keystoreToBLSExecution"])(this.file,this.password,this.executionAddress,this.selectedValidator.validator_index,"0x"+this.selectedValidator.decoded.withdrawal_credentials,t):this.blsExecution=await Object(v["mnemonicToBLSExecution"])({mnemonic:this.parsedPhrase},this.executionAddress,this.selectedValidator.validator_index,"0x"+this.selectedValidator.decoded.withdrawal_credentials,t),this.loadingButton=!1,this.nextStep()}catch(t){this.loadingButton=!1,Object(b["e"])(t,{},b["a"]),this.reset()}},reset(){this.$refs.addressInput&&this.$refs.addressInput.clear(),this.openWithdrawalModal=!1,this.selectedValidator=null,this.step=1,this.executionAddress=this.address,this.isValidAddress=!1,this.selectedRecoveryType="",this.file={},this.password="",this.blsExecution="",this.phrase={},this.loadingButton=!1,this.refetchValidators()},setType(t){this.selectedRecoveryType=t,this.nextStep()},uploadFile(t){const e=new FileReader;e.onloadend=t=>{try{this.file=JSON.parse(t.target.result),this.setType(x["a"].KEYSTORE)}catch(e){Object(b["e"])(e.message,{},b["a"])}},e.readAsBinaryString(t.target.files[0])},userSelectFile(){const t=this.$refs.jsonInput;t.value="",t.click()},nextStep(){this.step+=1},back(){const t=this.$refs.jsonInput;switch(this.step){case 2:this.selectedRecoveryType="",t.value="";break;case 3:this.password="",this.phrase={},this.file={};break;default:break}this.step-=1},setAddress(t,e){this.executionAddress=t,this.isValidAddress=e},openModal(t){this.selectedValidator=t,this.openWithdrawalModal=!0},closeModal(){this.reset()},convertToEth1(t,e=9){return new u.a(t).div(new u.a(10).pow(e))},getAverageApr(t,e,a){if(e.lte(0))return u()(0);const s=m.a.utc(),i=m.a.utc(t),n=s.diff(i,"days"),r=u()(e).div(a),o=u()(r).dividedBy(n),d=o.times(365).times(100);return new u.a(d)},expand(t){this.expanded=this.expanded!==t?t:null},isExpanded(t){return this.expanded===t},onGoerli(){return this.network.type.name===f["GOERLI"].name},getEstimatedDuration(t){const e=m()().utc(),a=m()(t);return e.unix()===a.unix()?"Should activate momentarily":`${a.diff(e,"days")} days ${a.diff(e,"hours")} hours and ${a.diff(e,"minutes")} minutes`}}},S=_,C=(a("622c"),a("2877")),E=Object(C["a"])(S,l,c,!1,null,"20accb74",null),A=E.exports,V={name:"TheStakedLayout",components:{TheWrapperDapp:()=>Promise.resolve().then(a.bind(null,"580f")),StakedStepper:()=>a.e("chunk-2d21ea8e").then(a.bind(null,"d705")),"staked-status":A},data(){return{validNetworks:r["a"],headerImg:a("0143"),amount:0,header:{title:"Ethereum 2.0 staking",subtext:"Stake on Ethereum 2.0 and earn continuous rewards for providing a public good to the community.",subtextClass:"textMedium--text"},activeTab:0,handlerStaked:{},tabs:[{name:"Stake",route:{name:o.STAKED.NAME},id:0},{name:"Status",route:{name:o.STATUS.NAME,path:o.STATUS.PATH},id:1}]}},computed:{...Object(n["e"])("wallet",["web3","address"]),...Object(n["c"])("global",["network"]),...Object(n["c"])("article",["getArticle"]),myETHTotalStaked(){return Object(d["c"])(this.handlerStaked.myETHTotalStaked).value+" ETH"},totalStaked(){return Object(d["c"])(this.handlerStaked.totalStaked).value+" ETH"},currentAprFormatted(){return this.handlerStaked.apr>0?Object(d["g"])(this.handlerStaked.apr).value:"--"},pollingStatus(){return this.handlerStaked.pollingStatus},validators(){return this.handlerStaked.myValidators},loadingValidators(){return this.handlerStaked.loadingValidators},pendingTxHash(){return this.handlerStaked.pendingTxHash},isValidNetwork(){const t=this.network.type.chainID,e=this.validNetworks.filter(e=>e.chainID===t);return e.length>0}},watch:{$route(){this.detactUrlChangeTab()},pendingTxHash(t){""!==t&&(this.activeTab=1),this.$refs.stakedStepper&&this.$refs.stakedStepper.reset()},address(t){this.handlerStaked.address=t,this.$refs.stakedStepper&&this.$refs.stakedStepper.reset()}},mounted(){this.detactUrlChangeTab(),this.isValidNetwork&&(this.handlerStaked=new w["c"](this.web3,this.network,this.address))},methods:{detactUrlChangeTab(){const t=this.$route.name;t===o.STATUS.NAME?this.activeTab=this.tabs[1].id:this.activeTab=this.tabs[0].id},tabChanged(t){this.activeTab=t},startProvision(t){return this.handlerStaked.startProvision(t)},sendTransaction(t){this.handlerStaked.sendTransaction(),this.amount=t},refetchValidators(){this.handlerStaked.getValidators()}}},P=V,j=(a("54cc"),Object(C["a"])(P,s,i,!1,null,"75579cc4",null));e["default"]=j.exports},"468d":function(t,e,a){},"4a2b":function(t,e,a){"use strict";(function(t){a.d(e,"a",(function(){return p})),a.d(e,"b",(function(){return m})),a.d(e,"c",(function(){return v}));a("13d5");var s=a("bc3a"),i=a.n(s),n=a("901e"),r=a.n(n),o=a("7f65"),d=a("8e50"),l=a("9b88"),c=a("5ba3"),h=a("2623");const u=[{inputs:[],name:"get_deposit_count",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"}],p=[{inputs:[{internalType:"uint256",name:"numValidators",type:"uint256"}],name:"getFees",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],m={PENDING:"pending",ACTIVE:"active",CREATED:"created",DEPOSITED:"deposited",FAILED:"failed",EXITED:"exited"};class v{constructor(t,e,a){this.web3=t,this.network=e,this.address=a,this.totalStaked="",this.apr="",this.validatorsCount="",this.pollingStatus={},this.transactionData={},this.myValidators=[],this.loadingValidators=!1,this.myETHTotalStaked=0,this.pendingTxHash="",this.txReceipt=!1,this.endpoint=o["a"].network[this.network.type.name].endpoint,this.getTotalStakedAndAPR(),this.getValidators()}getTotalStakedAndAPR(){this.eth2ContractAddress=o["a"].network[this.network.type.name].depositAddress;const e=new this.web3.eth.Contract(u,this.eth2ContractAddress);e.methods.get_deposit_count().call().then(e=>{const a=Object(c["toBN"])("0x"+t.from(e.substr(2),"hex").reverse().toString("hex"));this.totalStaked=a.muln(32).toString(),this.apr=new r.a(Object(d["a"])({totalAtStake:this.totalStaked})).times(100).toFixed()}).catch(t=>{Object(l["e"])(t,{},l["a"])})}getValidators(){return this.loadingValidators=!0,i.a.get(`${this.endpoint}/history?address=${this.address}`,{header:{"Content-Type":"application/json"}}).then(t=>{this.myValidators=t.data,this.myETHTotalStaked=t.data.reduce((t,e)=>{const a=e.raw[0],s=a.status.toLowerCase()===m.ACTIVE&&a.balance?this.convertToEth1(a.balance).toFixed():0;return new r.a(t).plus(s)},0),this.loadingValidators=!1}).catch(t=>{this.loadingValidators=!1,this.myValidators=[],t.response&&404===t.response.status&&"No matching history found"===t.response.data.msg||Object(l["e"])(t,{},l["a"])})}async startProvision(t){this.validatorsCount=t.count,await i.a.post(this.endpoint+"/v2/provision",{address:this.address,eth1Address:t.eth2Address,validatorsCount:t.count},{header:{"Content-Type":"application/json"}}).then(t=>t&&t.data.provisioning_request_uuid?this.startPolling(t.data.provisioning_request_uuid):Object(l["e"])(this.$t("dappsStaked.error-try-again"),{},l["a"])).catch(t=>{this.pollingStatus={success:!1,error:t}})}startPolling(t){let e=!0;const a=setInterval(()=>{if(e)return e=!1,i.a.get(`${this.endpoint}/status?provisioning_request_uuid=${t}`,{header:{"Content-Type":"application/json"}}).then(t=>{e=!0,t&&t.data&&t.data.raw.length===parseInt(this.validatorsCount)&&(this.pollingStatus={success:!0},this.transactionData=t.data.transaction,clearInterval(a))}).catch(t=>{e=!0,t.response&&424===t.response.status&&"Not all validators have been provisioned"===t.response.data.msg||t.response&&404===t.response.status&&"Requested provisioning_request_uuid not found"===t.response.data.msg||(this.pollingStatus={success:!1,error:t.response})})},5e3)}sendTransaction(){this.transactionData.from=this.address,this.transactionData.to=o["a"].network[this.network.type.name].batchContract,this.web3.eth.sendTransaction(this.transactionData).on("transactionHash",t=>{this.pendingTxHash=t}).on("receipt",()=>{this.txReceipt=!0}).catch(t=>{const e=Object(h["a"])(t);e&&Object(l["e"])(t,{},l["a"])})}convertToEth1(t){return new r.a(t).div(new r.a(10).pow(9))}}}).call(this,a("1c35").Buffer)},"54cc":function(t,e,a){"use strict";a("9dc7")},"56e8":function(t,e,a){t.exports=a.p+"img/eth-dark-navy.ad11058d.svg"},"58fb":function(t,e,a){t.exports=a.p+"img/icon-mnemonic.7c3d34fc.svg"},"622c":function(t,e,a){"use strict";a("468d")},"7f65":function(t,e,a){"use strict";e["a"]={network:{GOERLI:{depositAddress:"0xff50ed3d0ec03aC01D4C79aAd74928BFF48a7b2b",endpoint:"https://stakedtest.mewapi.io",batchContract:"0xb483b22ee2097ee081fb2ce7aefcc776889f11a9",url:"https://goerli.beaconcha.in/validator/",etherscanTxUrl:"https://goerli.etherscan.io/tx/",etherscanAddrUrl:"https://goerli.etherscan.io/address/"},ETH:{depositAddress:"0x00000000219ab540356cBB839Cbe05303d7705Fa",endpoint:"https://staked.mewapi.io",batchContract:"0xF243A92eB7D4B4F6A00A57888B887bd01ec6fd12",url:"https://beaconcha.in/validator/",etherscanTxUrl:"https://etherscan.io/tx/",ethvmTxUrl:"https://www.ethvm.com/tx/",etherscanAddrUrl:"https://etherscan.io/address/",ethvmAddrUrl:"https://www.ethvm.com/address/"}}}},"8e50":function(t,e,a){"use strict";const s=({slotTimeInSec:t=12,slotsInEpoch:e=32,baseRewardFactor:a=64,totalAtStake:s=1e6,baseRewardsPerEpoch:i=4,baseRewardsPropotionalValidators:n=3,averageNetworkPctOnline:r=.95,oneSlotLatePenalty:o=.0156,vaildatorUptime:d=.99,validatorDeposit:l=32})=>{const c=31556908.8,h=c/(t*e),u=32e9*a/(1e9*s)**.5/i,p=4*u,m=u*n*r,v=.125*u*r,g=r+r*(1-r)*(1-o)+r*(1-r)**2*(1-2*o),w=.875*u*g,f=m+v+w,b=f*d,x=p*(1-d),y=h*(b-x);return y/1e9/l};e["a"]=s},"9dc7":function(t,e,a){}}]);
//# sourceMappingURL=../sourcemaps/js/dapp-staked~f71cff67.d28c373f.js.map